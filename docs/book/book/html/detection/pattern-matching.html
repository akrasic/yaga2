<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Pattern Matching - Yaga2 Anomaly Detection Guide</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Comprehensive guide to anomaly detection, SLO evaluation, and incident management">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "ayu";
            window.path_to_searchindex_js = "../searchindex-5019ba8d.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-e4c30426.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Yaga2 Anomaly Detection Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/smartbox/yaga2" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>
                        <a href="https://github.com/smartbox/yaga2/edit/main/docs/book/src/detection/pattern-matching.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <span class=fa-svg id="git-edit-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M421.7 220.3l-11.3 11.3-22.6 22.6-205 205c-6.6 6.6-14.8 11.5-23.8 14.1L30.8 511c-8.4 2.5-17.5 .2-23.7-6.1S-1.5 489.7 1 481.2L38.7 353.1c2.6-9 7.5-17.2 14.1-23.8l205-205 22.6-22.6 11.3-11.3 33.9 33.9 62.1 62.1 33.9 33.9zM96 353.9l-9.3 9.3c-.9 .9-1.6 2.1-2 3.4l-25.3 86 86-25.3c1.3-.4 2.5-1.1 3.4-2l9.3-9.3H112c-8.8 0-16-7.2-16-16V353.9zM453.3 19.3l39.4 39.4c25 25 25 65.5 0 90.5l-14.5 14.5-22.6 22.6-11.3 11.3-33.9-33.9-62.1-62.1L314.3 67.7l11.3-11.3 22.6-22.6 14.5-14.5c25-25 65.5-25 90.5 0z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="pattern-matching"><a class="header" href="#pattern-matching">Pattern Matching</a></h1>
<p>Pattern matching interprets ML signals by comparing metric combinations against known operational scenarios. This chapter explains what pattern matching is, how it works, and provides detailed examples of each pattern type.</p>
<h2 id="what-is-pattern-matching"><a class="header" href="#what-is-pattern-matching">What is Pattern Matching?</a></h2>
<p>While Isolation Forest answers <strong>“Is this unusual?”</strong>, pattern matching answers <strong>“What does this unusual behavior mean?”</strong></p>
<p>Pattern matching is a <strong>rule-based interpretation layer</strong> that recognizes known operational scenarios by examining how metrics relate to each other.</p>
<h3 id="why-pattern-matching"><a class="header" href="#why-pattern-matching">Why Pattern Matching?</a></h3>
<p>ML detection tells you something is anomalous, but not what it means:</p>
<pre><code>ML Output:
  application_latency: anomalous (score: -0.35)
  request_rate: anomalous (score: -0.28)
  error_rate: normal

Human question: "So... is this bad? What should I do?"
</code></pre>
<p>Pattern matching adds semantic meaning:</p>
<pre><code>Pattern Match: traffic_surge_degrading

Interpretation: "You have a traffic surge (3x normal) that's causing
  latency degradation (450ms vs 150ms normal). Errors are still normal,
  so you're approaching capacity but not failing yet."

Recommended Actions:
  1. Scale horizontally if possible
  2. Check resource bottlenecks (CPU, connections)
  3. Monitor error rate for signs of impending failure
</code></pre>
<h3 id="ml-vs-pattern-matching"><a class="header" href="#ml-vs-pattern-matching">ML vs Pattern Matching</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Aspect</th><th>Isolation Forest</th><th>Pattern Matching</th></tr>
</thead>
<tbody>
<tr><td><strong>Approach</strong></td><td>Statistical (unsupervised ML)</td><td>Rule-based (expert knowledge)</td></tr>
<tr><td><strong>Question answered</strong></td><td>“Is this unusual?”</td><td>“What does it mean?”</td></tr>
<tr><td><strong>Learns from</strong></td><td>Historical data</td><td>Domain expertise</td></tr>
<tr><td><strong>Catches</strong></td><td>Novel/unknown issues</td><td>Known operational scenarios</td></tr>
<tr><td><strong>Output</strong></td><td>Anomaly score</td><td>Named pattern + recommendations</td></tr>
<tr><td><strong>Adapts</strong></td><td>Automatically via training</td><td>Manually via pattern definitions</td></tr>
</tbody>
</table>
</div>
<h3 id="how-they-work-together"><a class="header" href="#how-they-work-together">How They Work Together</a></h3>
<pre><code>┌─────────────────────────────────────────────────────────────────────┐
│                   Sequential Detection Pipeline                      │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   Current Metrics                                                   │
│   ┌────────────────────────────────────┐                           │
│   │ request_rate: 850 req/s           │                           │
│   │ application_latency: 450ms         │                           │
│   │ error_rate: 1.5%                   │                           │
│   │ database_latency: 15ms             │                           │
│   └─────────────────┬──────────────────┘                           │
│                     │                                               │
│                     ▼                                               │
│   ┌─────────────────────────────────────────────────────────────┐   │
│   │  Phase 1: Isolation Forest Detection                        │   │
│   │                                                             │   │
│   │  For each metric, compute anomaly score:                    │   │
│   │    request_rate: score=-0.28, direction=high               │   │
│   │    application_latency: score=-0.35, direction=high        │   │
│   │    error_rate: score=-0.05, direction=normal               │   │
│   │    database_latency: score=0.1, direction=normal           │   │
│   │                                                             │   │
│   │  Output: List of AnomalySignal objects                     │   │
│   └─────────────────────────┬───────────────────────────────────┘   │
│                             │                                       │
│                             ▼                                       │
│   ┌─────────────────────────────────────────────────────────────┐   │
│   │  Phase 2: Pattern Interpretation                            │   │
│   │                                                             │   │
│   │  Convert signals to levels:                                 │   │
│   │    request_rate: high                                      │   │
│   │    application_latency: high                               │   │
│   │    error_rate: normal                                      │   │
│   │    database_latency: normal                                │   │
│   │                                                             │   │
│   │  Match against patterns:                                    │   │
│   │    traffic_surge_failing? No (errors not high)             │   │
│   │    traffic_surge_degrading? ✓ YES                          │   │
│   │                                                             │   │
│   │  Output: Interpreted anomaly with recommendations          │   │
│   └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
</code></pre>
<h2 id="how-pattern-matching-works"><a class="header" href="#how-pattern-matching-works">How Pattern Matching Works</a></h2>
<h3 id="step-1-convert-if-signals-to-metric-levels"><a class="header" href="#step-1-convert-if-signals-to-metric-levels">Step 1: Convert IF Signals to Metric Levels</a></h3>
<p>Each metric is classified based on its Isolation Forest signal:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Percentile Range</th><th>Level</th></tr>
</thead>
<tbody>
<tr><td>&gt; 95th</td><td><code>very_high</code></td></tr>
<tr><td>90th - 95th</td><td><code>high</code></td></tr>
<tr><td>80th - 90th</td><td><code>elevated</code></td></tr>
<tr><td>70th - 80th</td><td><code>moderate</code></td></tr>
<tr><td>10th - 70th</td><td><code>normal</code></td></tr>
<tr><td>5th - 10th</td><td><code>low</code></td></tr>
<tr><td>&lt; 5th</td><td><code>very_low</code></td></tr>
<tr><td>No IF signal</td><td><code>normal</code></td></tr>
</tbody>
</table>
</div>
<p><strong>Example:</strong></p>
<pre><code>IF says: latency is at 92nd percentile (score: -0.35)
Level: high (between 90th-95th)
</code></pre>
<h3 id="step-2-handle-lower-is-better-metrics"><a class="header" href="#step-2-handle-lower-is-better-metrics">Step 2: Handle “Lower is Better” Metrics</a></h3>
<p>Some metrics are better when low:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Metric</th><th>Lower is Better?</th><th>Why</th></tr>
</thead>
<tbody>
<tr><td><code>error_rate</code></td><td>Yes</td><td>0% errors is ideal</td></tr>
<tr><td><code>database_latency</code></td><td>Yes</td><td>Faster DB is better</td></tr>
<tr><td><code>dependency_latency</code></td><td>Yes</td><td>Faster dependencies is better</td></tr>
<tr><td><code>application_latency</code></td><td>No*</td><td>Low + high errors = fast-fail</td></tr>
</tbody>
</table>
</div>
<p>*Application latency is NOT in “lower is better” because low latency with high errors indicates fast failures (requests rejected before processing).</p>
<p>When IF flags a “lower is better” metric as anomalously low, it’s treated as <code>normal</code>:</p>
<pre><code>IF says: database_latency is unusually low (faster than normal)
Pattern matching: Treat as "normal" (this is good, not a problem)
</code></pre>
<h3 id="step-3-match-against-pattern-conditions"><a class="header" href="#step-3-match-against-pattern-conditions">Step 3: Match Against Pattern Conditions</a></h3>
<p>Each pattern has conditions that must be met:</p>
<pre><code class="language-python">"traffic_surge_degrading": {
    "conditions": {
        "request_rate": "high",           # Must be high
        "application_latency": "high",    # Must be high
        "error_rate": "normal",           # Must be normal
    }
}
</code></pre>
<p>The pattern matches only if <strong>all conditions</strong> are satisfied.</p>
<h3 id="step-4-generate-interpreted-output"><a class="header" href="#step-4-generate-interpreted-output">Step 4: Generate Interpreted Output</a></h3>
<p>When a pattern matches, generate:</p>
<ul>
<li>Human-readable description</li>
<li>Semantic interpretation</li>
<li>Recommended actions</li>
<li>Contributing metrics</li>
</ul>
<h2 id="named-patterns---detailed-reference"><a class="header" href="#named-patterns---detailed-reference">Named Patterns - Detailed Reference</a></h2>
<h3 id="traffic-patterns"><a class="header" href="#traffic-patterns">Traffic Patterns</a></h3>
<p>These patterns relate to changes in traffic volume (request rate).</p>
<h4 id="traffic_surge_healthy"><a class="header" href="#traffic_surge_healthy"><code>traffic_surge_healthy</code></a></h4>
<pre><code>┌─────────────────────────────────────────────────────────────────────┐
│  PATTERN: traffic_surge_healthy                                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Conditions:                                                        │
│    request_rate: high                                              │
│    application_latency: normal                                     │
│    error_rate: normal                                              │
│                                                                     │
│  Severity: low                                                      │
│                                                                     │
│  What It Means:                                                     │
│    Traffic has increased significantly (e.g., 3x normal) but       │
│    the service is handling it gracefully. Latency and errors       │
│    remain normal - your system has headroom.                       │
│                                                                     │
│  Possible Causes:                                                   │
│    • Marketing campaign launched                                   │
│    • Viral content / social media mention                          │
│    • Seasonal peak (holiday shopping)                              │
│    • Organic growth                                                │
│                                                                     │
│  Recommended Actions:                                               │
│    • Monitor for signs of degradation                              │
│    • Verify traffic is legitimate (not bot/attack)                 │
│    • Consider pre-emptive scaling if trend continues               │
│                                                                     │
│  Example Scenario:                                                  │
│    Black Friday starts. Traffic jumps from 100 req/s to 350 req/s. │
│    Latency stays at 150ms, errors at 0.1%.                         │
│    System is handling the surge well.                              │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
</code></pre>
<h4 id="traffic_surge_degrading"><a class="header" href="#traffic_surge_degrading"><code>traffic_surge_degrading</code></a></h4>
<pre><code>┌─────────────────────────────────────────────────────────────────────┐
│  PATTERN: traffic_surge_degrading                                   │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Conditions:                                                        │
│    request_rate: high                                              │
│    application_latency: high                                       │
│    error_rate: normal                                              │
│                                                                     │
│  Severity: high                                                     │
│                                                                     │
│  What It Means:                                                     │
│    Traffic surge is causing performance degradation. Users are     │
│    experiencing slower responses, but requests are still           │
│    completing successfully. You're approaching capacity.           │
│                                                                     │
│  Why Errors Are Still Normal:                                       │
│    The system is slowing down to cope with load rather than        │
│    failing. This is often due to:                                  │
│    • Thread pools filling up (requests queue)                      │
│    • Connection pools near exhaustion                              │
│    • CPU at high utilization but not 100%                          │
│                                                                     │
│  Recommended Actions:                                               │
│    • IMMEDIATE: Scale horizontally if possible                     │
│    • CHECK: Resource utilization (CPU, memory, connections)        │
│    • MONITOR: Error rate for signs of impending failure            │
│    • CONSIDER: Enable request throttling to protect backend        │
│                                                                     │
│  Example Scenario:                                                  │
│    Traffic: 850 req/s (normally 200 req/s)                         │
│    Latency: 450ms (normally 120ms)                                 │
│    Errors: 0.5% (normal)                                           │
│                                                                     │
│    Users notice slowness but can still complete transactions.      │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
</code></pre>
<h4 id="traffic_surge_failing"><a class="header" href="#traffic_surge_failing"><code>traffic_surge_failing</code></a></h4>
<pre><code>┌─────────────────────────────────────────────────────────────────────┐
│  PATTERN: traffic_surge_failing                                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Conditions:                                                        │
│    request_rate: high                                              │
│    application_latency: high                                       │
│    error_rate: high                                                │
│                                                                     │
│  Severity: critical                                                 │
│                                                                     │
│  What It Means:                                                     │
│    Service is at or beyond capacity. The traffic surge has         │
│    overwhelmed the system - both latency and errors are elevated.  │
│    Users are actively being impacted.                              │
│                                                                     │
│  Why This Is Critical:                                              │
│    High errors + high latency = users are both waiting AND         │
│    failing. This is the worst user experience - slow failures.     │
│                                                                     │
│  Recommended Actions:                                               │
│    • IMMEDIATE: Scale horizontally or add capacity                 │
│    • IMMEDIATE: Enable rate limiting to protect backend            │
│    • INVESTIGATE: Confirm traffic is legitimate vs attack          │
│    • PREPARE: Have rollback ready if recent deployment caused it   │
│                                                                     │
│  Example Scenario:                                                  │
│    Traffic: 1200 req/s (normally 200 req/s)                        │
│    Latency: 2500ms (normally 120ms)                                │
│    Errors: 15%                                                     │
│                                                                     │
│    System is collapsing under load. Many users seeing errors,      │
│    others waiting forever for timeouts.                            │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
</code></pre>
<h4 id="traffic_cliff"><a class="header" href="#traffic_cliff"><code>traffic_cliff</code></a></h4>
<pre><code>┌─────────────────────────────────────────────────────────────────────┐
│  PATTERN: traffic_cliff                                             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Conditions:                                                        │
│    request_rate: very_low (sudden drop to &lt;10% of normal)          │
│                                                                     │
│  Severity: critical                                                 │
│                                                                     │
│  What It Means:                                                     │
│    Traffic has suddenly dropped to near-zero. This often           │
│    indicates an upstream problem preventing requests from          │
│    reaching the service.                                           │
│                                                                     │
│  Common Causes:                                                     │
│    • DNS failure (users can't resolve hostname)                    │
│    • Load balancer misconfigured (routing to wrong backend)        │
│    • Firewall rule blocking traffic                                │
│    • CDN/edge failure                                              │
│    • Upstream service failure                                      │
│    • Network partition                                             │
│                                                                     │
│  Why Not Low Latency Pattern:                                       │
│    The few requests getting through might show normal latency,     │
│    but the problem is that NO requests are arriving.               │
│                                                                     │
│  Recommended Actions:                                               │
│    • IMMEDIATE: Check upstream services and load balancers         │
│    • CHECK: DNS resolution from multiple locations                 │
│    • VERIFY: Network connectivity and firewall rules               │
│    • CORRELATE: Check if other services are also affected          │
│                                                                     │
│  Example Scenario:                                                  │
│    Traffic: 5 req/s (normally 200 req/s) - 97.5% drop             │
│                                                                     │
│    At 2:15 PM, traffic suddenly drops from 200 req/s to 5 req/s.  │
│    Investigation reveals DNS TTL expired and DNS provider had      │
│    an outage, causing resolution failures.                         │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 id="error-patterns"><a class="header" href="#error-patterns">Error Patterns</a></h3>
<p>These patterns relate to error rate anomalies.</p>
<h4 id="error_rate_elevated"><a class="header" href="#error_rate_elevated"><code>error_rate_elevated</code></a></h4>
<pre><code>┌─────────────────────────────────────────────────────────────────────┐
│  PATTERN: error_rate_elevated                                       │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Conditions:                                                        │
│    request_rate: normal                                            │
│    application_latency: normal                                     │
│    error_rate: high                                                │
│                                                                     │
│  Severity: high                                                     │
│                                                                     │
│  What It Means:                                                     │
│    Error rate has increased significantly, but traffic and         │
│    latency are normal. This usually indicates a specific code      │
│    path or endpoint is failing, not a systemic issue.              │
│                                                                     │
│  Common Causes:                                                     │
│    • Bug in a specific endpoint                                    │
│    • External dependency failing for certain operations            │
│    • Bad input data causing validation failures                    │
│    • Feature flag enabled broken code                              │
│    • Database constraint violations                                │
│                                                                     │
│  Why Latency Is Normal:                                             │
│    Most requests succeed normally - only a subset is failing.      │
│    The average latency doesn't change much because successes       │
│    dominate the metrics.                                           │
│                                                                     │
│  Recommended Actions:                                               │
│    • INVESTIGATE: Check exception types in exception_context       │
│    • CHECK: Recent deployments or configuration changes            │
│    • IDENTIFY: Which endpoints/operations are failing              │
│    • VERIFY: External dependency health                            │
│                                                                     │
│  Example Scenario:                                                  │
│    Traffic: 150 req/s (normal)                                     │
│    Latency: 120ms (normal)                                         │
│    Errors: 3.5% (normally 0.1%)                                    │
│                                                                     │
│    Exception breakdown shows 85% of errors are                     │
│    "PaymentGatewayException" - the payment provider is having      │
│    issues, but only checkout flow is affected.                     │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
</code></pre>
<h4 id="error_rate_critical"><a class="header" href="#error_rate_critical"><code>error_rate_critical</code></a></h4>
<pre><code>┌─────────────────────────────────────────────────────────────────────┐
│  PATTERN: error_rate_critical                                       │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Conditions:                                                        │
│    request_rate: normal                                            │
│    application_latency: normal                                     │
│    error_rate: very_high (&gt;5%)                                     │
│                                                                     │
│  Severity: critical                                                 │
│                                                                     │
│  What It Means:                                                     │
│    A significant portion of requests are failing. While the        │
│    service responds quickly (suggesting infrastructure is OK),     │
│    business logic is failing at a high rate.                       │
│                                                                     │
│  Common Causes:                                                     │
│    • Critical bug in recent deployment                             │
│    • Database schema mismatch after migration                      │
│    • External API contract changed                                 │
│    • Authentication/authorization failure                          │
│    • Missing configuration or secrets                              │
│                                                                     │
│  Recommended Actions:                                               │
│    • IMMEDIATE: Check recent deployments (rollback candidate)      │
│    • INVESTIGATE: Exception breakdown for root cause               │
│    • CHECK: Database connectivity and schema                       │
│    • VERIFY: All required configuration/secrets present            │
│                                                                     │
│  Example Scenario:                                                  │
│    Traffic: 150 req/s (normal)                                     │
│    Latency: 80ms (normal - fast errors)                           │
│    Errors: 25%                                                     │
│                                                                     │
│    Exception breakdown: 100% "DatabaseSchemaException"             │
│    Recent deployment added a required column, but migration        │
│    didn't run in production.                                       │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 id="latency-patterns"><a class="header" href="#latency-patterns">Latency Patterns</a></h3>
<p>These patterns relate to response time anomalies.</p>
<h4 id="latency_spike_recent"><a class="header" href="#latency_spike_recent"><code>latency_spike_recent</code></a></h4>
<pre><code>┌─────────────────────────────────────────────────────────────────────┐
│  PATTERN: latency_spike_recent                                      │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Conditions:                                                        │
│    request_rate: normal                                            │
│    application_latency: high                                       │
│    error_rate: normal                                              │
│                                                                     │
│  Severity: high                                                     │
│                                                                     │
│  What It Means:                                                     │
│    Latency increased without traffic change. Something changed     │
│    in the system - this is NOT a capacity issue (traffic is        │
│    normal). Likely a recent deployment, config change, or          │
│    dependency degradation.                                         │
│                                                                     │
│  Why Traffic Being Normal Matters:                                  │
│    If traffic were high, latency increase would make sense         │
│    (capacity). With normal traffic, the slowdown is internal.      │
│                                                                     │
│  Common Causes:                                                     │
│    • Recent deployment introduced inefficiency                     │
│    • Database query plan regression                                │
│    • New logging/tracing overhead                                  │
│    • Downstream service slower                                     │
│    • GC pressure from memory leak                                  │
│    • Missing cache (cold cache after restart)                      │
│                                                                     │
│  Recommended Actions:                                               │
│    • IMMEDIATE: Check deployments in last 2 hours                  │
│    • CHECK: Configuration changes (feature flags, settings)        │
│    • CHECK: External dependency response times                     │
│    • CHECK: Database query performance                             │
│    • CHECK: GC behavior and memory pressure                        │
│                                                                     │
│  Example Scenario:                                                  │
│    Traffic: 150 req/s (normal)                                     │
│    Latency: 450ms (normally 150ms)                                 │
│    Errors: 0.1% (normal)                                           │
│                                                                     │
│    Timeline shows latency jumped at 10:30 AM.                      │
│    Deployment log shows release v2.3.4 deployed at 10:28 AM.       │
│    New release added detailed audit logging that's synchronous.    │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
</code></pre>
<h4 id="internal_latency_issue"><a class="header" href="#internal_latency_issue"><code>internal_latency_issue</code></a></h4>
<pre><code>┌─────────────────────────────────────────────────────────────────────┐
│  PATTERN: internal_latency_issue                                    │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Conditions:                                                        │
│    application_latency: high                                       │
│    dependency_latency: normal                                          │
│    database_latency: normal                                        │
│                                                                     │
│  Severity: high                                                     │
│                                                                     │
│  What It Means:                                                     │
│    The service itself is slow, but all its dependencies            │
│    (database, external services) are fast. The problem is          │
│    INTERNAL to the application code.                               │
│                                                                     │
│  Why This Is Significant:                                           │
│    Eliminates external causes. The fix must be in this service,    │
│    not upstream/downstream.                                        │
│                                                                     │
│  Common Causes:                                                     │
│    • CPU-intensive computation                                     │
│    • Memory allocation/GC pressure                                 │
│    • Lock contention / thread starvation                           │
│    • Inefficient algorithm (O(n²) loop)                           │
│    • Synchronous I/O blocking event loop                           │
│    • Missing async/await causing serialization                     │
│                                                                     │
│  Recommended Actions:                                               │
│    • PROFILE: CPU profiling to find hot paths                      │
│    • CHECK: Thread dumps for lock contention                       │
│    • CHECK: Memory usage and GC logs                               │
│    • REVIEW: Recent code changes for algorithmic issues            │
│                                                                     │
│  Example Scenario:                                                  │
│    App latency: 800ms                                              │
│    Client latency: 50ms (fast external calls)                      │
│    DB latency: 10ms (fast queries)                                 │
│                                                                     │
│    Where's the extra 740ms? Profiling reveals a nested loop        │
│    iterating over large collections - O(n²) complexity.            │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
</code></pre>
<h4 id="database_bottleneck"><a class="header" href="#database_bottleneck"><code>database_bottleneck</code></a></h4>
<pre><code>┌─────────────────────────────────────────────────────────────────────┐
│  PATTERN: database_bottleneck                                       │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Conditions:                                                        │
│    database_latency: high                                          │
│    application_latency: high                                       │
│    db_latency_ratio: &gt; 0.7 (DB is &gt;70% of total latency)          │
│                                                                     │
│  Severity: high                                                     │
│                                                                     │
│  What It Means:                                                     │
│    Database operations dominate response time. The database        │
│    is the bottleneck - fixing app code won't help much.            │
│                                                                     │
│  Why The Ratio Matters:                                             │
│    If DB is 15ms out of 500ms total, DB isn't the problem.         │
│    If DB is 400ms out of 500ms total, DB IS the problem.           │
│                                                                     │
│  Common Causes:                                                     │
│    • Missing database index                                        │
│    • Query plan regression (statistics stale)                      │
│    • Lock contention in database                                   │
│    • Database server under-provisioned                             │
│    • N+1 query pattern                                             │
│    • Full table scans                                              │
│                                                                     │
│  Recommended Actions:                                               │
│    • INVESTIGATE: Slow query logs                                  │
│    • CHECK: Missing indexes on frequently queried columns          │
│    • CHECK: Database CPU and I/O metrics                           │
│    • ANALYZE: Query execution plans                                │
│    • CONSIDER: Query caching or read replicas                      │
│                                                                     │
│  Example Scenario:                                                  │
│    App latency: 650ms                                              │
│    DB latency: 520ms (80% of total)                                │
│    Client latency: 10ms                                            │
│                                                                     │
│    Slow query log shows: SELECT * FROM orders WHERE                │
│    customer_id = ? taking 500ms. Missing index on customer_id.     │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
</code></pre>
<h4 id="downstream_cascade"><a class="header" href="#downstream_cascade"><code>downstream_cascade</code></a></h4>
<pre><code>┌─────────────────────────────────────────────────────────────────────┐
│  PATTERN: downstream_cascade                                        │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Conditions:                                                        │
│    dependency_latency: high                                            │
│    application_latency: high                                       │
│    dependency_latency_ratio: &gt; 0.6 (external calls &gt;60% of total)      │
│                                                                     │
│  Severity: high                                                     │
│                                                                     │
│  What It Means:                                                     │
│    External dependency calls are dominating response time.         │
│    The service you're looking at is slow BECAUSE something         │
│    it depends on is slow.                                          │
│                                                                     │
│  Why This Pattern Exists:                                           │
│    Helps you avoid blaming the wrong service. If booking           │
│    is slow because search is slow, fix search, not booking.        │
│                                                                     │
│  What To Look At:                                                   │
│    • service_graph_context shows downstream call breakdown         │
│    • Identify which downstream service is slowest                  │
│    • That service is likely the root cause                         │
│                                                                     │
│  Recommended Actions:                                               │
│    • FOCUS: Investigate the slow downstream service                │
│    • CHECK: service_graph_context for detailed breakdown           │
│    • CORRELATE: Does downstream service also have anomalies?       │
│    • CONSIDER: Circuit breaker to fail fast                        │
│                                                                     │
│  Example Scenario:                                                  │
│    App latency: 1200ms                                             │
│    Client latency: 950ms (79% of total)                            │
│    DB latency: 15ms                                                │
│                                                                     │
│    service_graph_context shows:                                    │
│      search-api: 850ms avg (highest)                               │
│      payment-api: 50ms avg                                         │
│      inventory-api: 40ms avg                                       │
│                                                                     │
│    Root cause: search-api is slow, causing booking to be slow.     │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 id="fast-fail-patterns"><a class="header" href="#fast-fail-patterns">Fast-Fail Patterns</a></h3>
<p>These patterns indicate requests failing before normal processing.</p>
<h4 id="fast_rejection"><a class="header" href="#fast_rejection"><code>fast_rejection</code></a></h4>
<pre><code>┌─────────────────────────────────────────────────────────────────────┐
│  PATTERN: fast_rejection                                            │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Conditions:                                                        │
│    application_latency: very_low                                   │
│    error_rate: very_high                                           │
│                                                                     │
│  Severity: critical                                                 │
│                                                                     │
│  What It Means:                                                     │
│    Requests are failing VERY fast. They're being rejected          │
│    before reaching normal application logic. Something is          │
│    blocking requests at the entry point.                           │
│                                                                     │
│  Why Low Latency + High Errors Is Bad:                              │
│    Normal errors take time (processing, then failure).             │
│    Fast errors mean immediate rejection - no processing at all.    │
│                                                                     │
│  Common Causes:                                                     │
│    • Circuit breaker OPEN (rejecting all requests)                 │
│    • Rate limiter active (over quota)                              │
│    • Authentication/authorization failure                          │
│    • Invalid API key or expired token                              │
│    • TLS certificate mismatch                                      │
│    • Connection pool exhausted (immediate rejection)               │
│                                                                     │
│  Recommended Actions:                                               │
│    • IMMEDIATE: Check circuit breaker status                       │
│    • CHECK: Rate limiter configuration and current rate            │
│    • CHECK: Authentication service health                          │
│    • VERIFY: API keys and certificates are valid                   │
│                                                                     │
│  Example Scenario:                                                  │
│    Latency: 5ms (normally 150ms)                                   │
│    Errors: 95%                                                     │
│                                                                     │
│    5ms is just enough time to check auth and reject.               │
│    Auth service is down, causing all requests to fail at           │
│    the middleware layer before reaching business logic.            │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
</code></pre>
<h4 id="fast_failure"><a class="header" href="#fast_failure"><code>fast_failure</code></a></h4>
<pre><code>┌─────────────────────────────────────────────────────────────────────┐
│  PATTERN: fast_failure                                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Conditions:                                                        │
│    application_latency: low                                        │
│    error_rate: high                                                │
│                                                                     │
│  Severity: critical                                                 │
│                                                                     │
│  What It Means:                                                     │
│    Requests are failing quickly - faster than normal processing    │
│    would take. Similar to fast_rejection but with slightly         │
│    more processing time (maybe some validation runs).              │
│                                                                     │
│  The Latency-Error Relationship:                                    │
│    Normal request: Validate → Process → DB → External → Return     │
│    Fast failure: Validate → Fail (skip processing)                 │
│                                                                     │
│  Common Causes:                                                     │
│    • Early validation failure                                      │
│    • Feature flag disabled critical path                           │
│    • Missing required configuration                                │
│    • Database connection failure (fail after connect attempt)      │
│                                                                     │
│  Recommended Actions:                                               │
│    • CHECK: Application logs for error patterns                    │
│    • CHECK: Required configuration and feature flags               │
│    • CHECK: Database and cache connectivity                        │
│    • REVIEW: Recent deployments for breaking changes               │
│                                                                     │
│  Example Scenario:                                                  │
│    Latency: 25ms (normally 200ms)                                  │
│    Errors: 80%                                                     │
│                                                                     │
│    Logs show: "Redis connection failed"                            │
│    Redis cluster is unreachable. Service tries to connect          │
│    (25ms timeout), fails, returns error.                           │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 id="cascade-patterns"><a class="header" href="#cascade-patterns">Cascade Patterns</a></h3>
<p>These patterns relate to dependency failures propagating.</p>
<h4 id="upstream_cascade"><a class="header" href="#upstream_cascade"><code>upstream_cascade</code></a></h4>
<pre><code>┌─────────────────────────────────────────────────────────────────────┐
│  PATTERN: upstream_cascade                                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Conditions:                                                        │
│    application_latency: high                                       │
│    _dependency_context: upstream_anomaly                           │
│                                                                     │
│  Severity: high                                                     │
│                                                                     │
│  What It Means:                                                     │
│    This service is slow, AND at least one of its upstream          │
│    dependencies also has an anomaly. The root cause is likely      │
│    in the upstream service, not here.                              │
│                                                                     │
│  How Cascade Detection Works:                                       │
│    1. Yaga2 runs detection for all services (Pass 1)               │
│    2. For services with latency anomalies, check dependencies      │
│    3. If a dependency has an anomaly, it's a cascade               │
│    4. Trace the chain to find the root cause service               │
│                                                                     │
│  Why This Matters:                                                  │
│    Without cascade detection, you'd get 5 alerts for 5 services    │
│    when only 1 service (the root cause) needs fixing.              │
│                                                                     │
│  Example Dependency Chain:                                          │
│    mobile-api → booking → vms → titan                              │
│                                                                     │
│    If titan has a database issue, all 4 services will be slow.     │
│    Cascade detection identifies titan as root cause.               │
│                                                                     │
│  cascade_analysis Output:                                           │
│    {                                                                │
│      "is_cascade": true,                                           │
│      "root_cause_service": "titan",                                │
│      "affected_chain": ["titan", "vms", "booking", "mobile-api"],  │
│      "cascade_type": "upstream_cascade"                            │
│    }                                                                │
│                                                                     │
│  Recommended Actions:                                               │
│    • FOCUS: Investigate root_cause_service first                   │
│    • IGNORE: Don't fix downstream services (they'll recover)       │
│    • CORRELATE: Check root cause service's anomaly for details     │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
</code></pre>
<h2 id="pattern-matching-in-action"><a class="header" href="#pattern-matching-in-action">Pattern Matching in Action</a></h2>
<h3 id="complete-example-traffic-surge"><a class="header" href="#complete-example-traffic-surge">Complete Example: Traffic Surge</a></h3>
<pre><code>Input Metrics at 2:30 PM:
─────────────────────────────────────────────────────────────
  request_rate: 850 req/s (baseline: 200 req/s)
  application_latency: 420ms (baseline: 120ms)
  error_rate: 0.5% (baseline: 0.1%)
  database_latency: 15ms (baseline: 12ms)
  dependency_latency: 45ms (baseline: 40ms)

Phase 1: Isolation Forest
─────────────────────────────────────────────────────────────
  request_rate:        score=-0.42  percentile=96  → very_high
  application_latency: score=-0.35  percentile=94  → high
  error_rate:          score=-0.08  percentile=72  → normal
  database_latency:    score=0.05   percentile=55  → normal
  dependency_latency:      score=0.02   percentile=52  → normal

Phase 2: Level Classification
─────────────────────────────────────────────────────────────
  request_rate: very_high (&gt;95th percentile)
  application_latency: high (90-95th percentile)
  error_rate: normal (errors not anomalous)
  database_latency: normal (not flagged by IF)
  dependency_latency: normal (not flagged by IF)

Phase 3: Pattern Matching
─────────────────────────────────────────────────────────────
  Checking: traffic_surge_failing
    Conditions: request_rate=high ✓, latency=high ✓, errors=high ✗
    Result: NO MATCH (errors are normal)

  Checking: traffic_surge_degrading
    Conditions: request_rate=high ✓, latency=high ✓, errors=normal ✓
    Result: MATCH ✓

Output:
─────────────────────────────────────────────────────────────
{
  "pattern_name": "traffic_surge_degrading",
  "severity": "high",
  "description": "Traffic surge causing slowdown: 850 req/s driving
    latency to 420ms (errors stable at 0.50%)",
  "interpretation": "Service is slowing under load but not failing -
    approaching capacity. Users experiencing degraded performance but
    requests are completing.",
  "recommended_actions": [
    "IMMEDIATE: Scale horizontally if possible",
    "CHECK: Resource bottlenecks (CPU, memory, connections)",
    "MONITOR: Error rate for signs of impending failure",
    "CONSIDER: Enable request throttling to protect backend"
  ],
  "metric_levels": {
    "request_rate": "very_high",
    "application_latency": "high",
    "error_rate": "normal"
  }
}
</code></pre>
<h2 id="adding-new-patterns"><a class="header" href="#adding-new-patterns">Adding New Patterns</a></h2>
<p>To add a new pattern, edit <code>smartbox_anomaly/detection/interpretations.py</code>:</p>
<pre><code class="language-python">MULTIVARIATE_PATTERNS["cache_miss_storm"] = PatternDefinition(
    name="cache_miss_storm",
    conditions={
        "request_rate": "normal",
        "database_latency": "high",
        "db_latency_ratio": "&gt; 0.8",
    },
    severity="high",
    message_template=(
        "Cache miss storm: {database_latency:.0f}ms DB latency "
        "({db_latency_ratio:.0%} of total response time)"
    ),
    interpretation=(
        "Database is handling requests that should be cached. "
        "Cache service may be down or TTL expired for hot keys."
    ),
    recommended_actions=[
        "CHECK: Cache service health (Redis/Memcached)",
        "CHECK: Cache hit rate metrics",
        "VERIFY: Cache TTL hasn't expired for hot keys",
        "CONSIDER: Implementing cache warming",
    ],
)
</code></pre>
<h3 id="pattern-conditions"><a class="header" href="#pattern-conditions">Pattern Conditions</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Condition Type</th><th>Example</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>Level</td><td><code>"request_rate": "high"</code></td><td>Metric must be at this level</td></tr>
<tr><td>Ratio</td><td><code>"db_latency_ratio": "&gt; 0.7"</code></td><td>Ratio must exceed threshold</td></tr>
<tr><td>Any</td><td><code>"error_rate": "any"</code></td><td>Matches any level</td></tr>
<tr><td>Dependency</td><td><code>"_dependency_context": "upstream_anomaly"</code></td><td>Cascade detection</td></tr>
</tbody>
</table>
</div>
<h3 id="recommendation-prefixes"><a class="header" href="#recommendation-prefixes">Recommendation Prefixes</a></h3>
<p>Use these prefixes for consistent action ordering:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Prefix</th><th>Priority</th><th>Use For</th></tr>
</thead>
<tbody>
<tr><td><code>IMMEDIATE</code></td><td>1</td><td>Actions needed right now</td></tr>
<tr><td><code>CHECK</code></td><td>2</td><td>Things to investigate</td></tr>
<tr><td><code>INVESTIGATE</code></td><td>3</td><td>Deeper analysis needed</td></tr>
<tr><td><code>MONITOR</code></td><td>4</td><td>Ongoing observation</td></tr>
<tr><td><code>CONSIDER</code></td><td>5</td><td>Optional improvements</td></tr>
</tbody>
</table>
</div>
<h2 id="further-reading"><a class="header" href="#further-reading">Further Reading</a></h2>
<ul>
<li><a href="./isolation-forest.html">Isolation Forest</a> - How ML detection works</li>
<li><a href="./pipeline.html">Detection Pipeline</a> - End-to-end detection flow</li>
<li><a href="../reference/api-payload.html">API Payload Reference</a> - Output format</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../detection/isolation-forest.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../detection/pipeline.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../detection/isolation-forest.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../detection/pipeline.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
